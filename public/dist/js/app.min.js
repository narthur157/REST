angular.module("sampleApp",["ngRoute","appRoutes","MainController","NoteController","FireFactory"]);var app=angular.module("appRoutes",[]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/home.html",controller:"MainController"}).when("/bears",{templateUrl:"views/bear.html",controller:"BearController"}).when("/notes",{templateUrl:"views/notes.html",controller:"NoteController"}),b.html5Mode(!0)}]);var app=angular.module("MainController",[]);app.controller("MainController",function(){});var app=angular.module("NoteController",["FireFactory","firebase"]);app.controller("NoteController",["$scope","FireFactory","$firebase",function(a,b,c){a.school="Binghamton",a.classIdentifier="CS350",a.lecture="aLecture",a.authenticated=!1,a.otherNotes=[],a.message="",a.chatLog="";var d=b;d.setup(a.school,a.classIdentifier,a.lecture,function(){a.authenticated=!0,a.$apply();var b=new Firebase("https://burning-fire-602.firebaseio.com/web/data/"),e=c(b),f=e.$asObject();f.$bindTo(a,"data");var g=new Firebase("https://burning-fire-602.firebaseio.com/web/data/"+a.school+"/"+a.classIdentifier+"/"+a.lecture+"/chat"),h=new FirechatUI(g,document.getElementById("firechat-wrapper"));h.setUser(d.user.uid,d.user.displayName)}),a.otherNotes=d.otherNotes,a.chatLog=d.chatLog,a.login=function(){d.authClient.login("google"),d.authClient&&(a.authenticated=!0,a.$apply())},a.logout=function(){d.authClient.logout(),a.authenticated=!1,a.$apply()},a.showNote=function(b){console.log(a.otherNotes),console.log(_.where(a.otherNotes,{uid:b})),d.getNote(b)},a.sendMessage=function(a){d.sendChatMessage(a)}}]);var app=angular.module("FireFactory",[]);app.factory("FireFactory",function(a){function b(b){var c=a.defer();return d(b.name()).then(function(a){c.resolve({uid:b.name(),displayName:a,note:b.val()})}),c.promise}function c(a){h.noteRef.on("child_added",function(a){a.name()!==h.user.uid&&b(a).then(function(a){console.log("new child! congratulations!"),h.otherNotes.push(a)})}),h.lectureRef.child("chat").on("child_added",function(a){var b=a.val();h.chatLog.push({user:b.user,text:b.text,time:b.time})}),h.userRef=new Firebase(g+"/"+h.user.uid),h.createPad("usersPad",h.user.uid,h.userRef),a()}function d(b){var c=a.defer();if(!h.lectureRef)throw"LectureRefNull";if(!b)throw"getNameFromIdNullId";return h.rootRef.child("users").startAt().once("value",function(a){a.forEach(function(a){var d=a.val(),e=d.provider+":"+d.provider_id;e===b&&c.resolve(d.displayName)})}),c.promise}var e="https://burning-fire-602.firebaseio.com/web/data/",f=null,g=null,h={};return h.user=null,h.authClient=null,h.rootRef=null,h.lectureRef=null,h.userRef=null,h.selectedRef=null,h.noteRef=null,h.authClient=null,h.chatLog=[],h.otherNotes=[],h.createPad=function(a,b,c){var d=!1;"usersPad"===a&&(d=!0);var e=document.createElement("div");e.id=a,document.getElementById("contentDiv").appendChild(e);var f=CodeMirror(document.getElementById(a),{lineWrapping:!0,readOnly:!d}),g=Firepad.fromCodeMirror(c,f,{richTextToolbar:d,richTextShortcuts:d,userId:b});return{firePadRef:g,codeMirrorRef:f}},h.getNote=function(a){this.selectedRef=new Firebase(g+"/"+a),this.createPad(a,a,this.selectedRef)},h.setup=function(a,b,d,i){f=e+a+"/"+b+"/"+d,g=f+"/notes",this.rootRef=new Firebase(e),this.lectureRef=new Firebase(f),this.noteRef=new Firebase(g),h.authClient=new FirebaseSimpleLogin(this.lectureRef,function(a,b){return a?(console.log(a),null):void(b?(console.log("hello, "+b.displayName),h.rootRef.child("users").child(b.uid).set({displayName:b.displayName,provider:b.provider,provider_id:b.id}),h.user=b,c(i)):(console.log("weird stuff happening"),console.log(h.lectureRef)))})},h.sendChatMessage=function(a){this.lectureRef.child("chat").push({user:this.user.displayName,text:a,time:1})},h});